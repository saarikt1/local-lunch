(this.webpackJsonpfrontend=this.webpackJsonpfrontend||[]).push([[0],{109:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),l=a(26),o=a.n(l),c=a(29),i=a.n(c),s=a(35),u=a(22),m=a(37),h=a.n(m),f=a(135),d=a(126),p=a(141),b=a(127),E=a(111),g=a(129),x=a(138),y=a(130),v=a(128),w=Object(d.a)({root:{maxWidth:300,minWidth:300,margin:"8px 16px"},media:{height:140},bullet:{display:"inline-block",margin:"0 4px"}}),j=function(e){var t=e.restaurant,a=w(),n=r.a.createElement("span",{className:a.bullet},"\u2022");return r.a.createElement(p.a,{className:a.root},r.a.createElement(b.a,null,r.a.createElement(E.a,{gutterBottom:!0,variant:"h5",component:"h2"},t?t.name:r.a.createElement(v.a,null)),r.a.createElement(E.a,{variant:"body2",color:"textSecondary",component:"p"},t?r.a.createElement(r.a.Fragment,null,"Takeaway",n,"Big groups",n,"Fast service",n,"Buffet"):r.a.createElement(v.a,{width:"60%"}))),r.a.createElement(g.a,null,t?r.a.createElement(x.a,{size:"small",color:"primary"},t.website&&r.a.createElement(y.a,{href:t.website},"Website")):r.a.createElement(v.a,{variant:"rect",width:56,height:22,style:{marginLeft:"8px",marginBottom:"8px"}})))},O=a(137),F=a(142),S=a(143),M=a(140),C=a(131),k=a(132),W=a(133),D=function(e){var t=e.userLocation,a=e.restaurantSuggestions,l=Object(n.useState)([[62.9894714,34.558059],[38.1706012,-3.976497]]),o=Object(u.a)(l,2),c=o[0],i=o[1];return Object(n.useEffect)((function(){t&&a&&function(){var e=a.reduce((function(e,t){return Math.max(e,t.latlon.x)}),t.lat),n=a.reduce((function(e,t){return Math.min(e,t.latlon.y)}),t.lon),r=a.reduce((function(e,t){return Math.min(e,t.latlon.x)}),t.lat),l=a.reduce((function(e,t){return Math.max(e,t.latlon.y)}),t.lon);i([[e,l],[r,n]])}()}),[a,i,t]),r.a.createElement(r.a.Fragment,null,r.a.createElement(O.a,{id:"map",flex:"1",padding:"8px"},r.a.createElement(F.a,{useFlyTo:"true",bounds:c,boundsOptions:{padding:[35,35]},scrollWheelZoom:!1,style:{width:"100%",height:"500px"}},r.a.createElement(S.a,{url:"https://api.mapbox.com/styles/v1/mapbox/streets-v11/tiles/256/{z}/{x}/{y}?access_token=".concat("pk.eyJ1IjoidG9tbWlzIiwiYSI6ImNrY2FjMXZoazFkZmoyc3A4MzR6NHhta3UifQ.FEItf-Tx4knfi3RtN88_FA"),attribution:'\xa9 <a href="https://www.openstreetmap.org/">OpenStreetMap</a>, <a href="https://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, \xa9 <a href="https://www.mapbox.com/">Mapbox</a>'}),t&&r.a.createElement(M.a,{center:t,radius:15},r.a.createElement(C.a,null,r.a.createElement(E.a,{variant:"subtitle1"},"Your location"))),a&&a.map((function(e){return r.a.createElement(k.a,{key:e.id,position:[e.latlon.x,e.latlon.y]},r.a.createElement(W.a,{permanent:!0},e.name),r.a.createElement(C.a,null,r.a.createElement(E.a,{variant:"h6"},e.name),r.a.createElement(y.a,{href:e.website},e.website)))})))))},L=function(e){var t=e.restaurants,a=e.userLocation,l=e.isWithDistance,o=Object(n.useState)(),c=Object(u.a)(o,2),i=c[0],s=c[1];return Object(n.useEffect)((function(){var e;t&&a&&l&&function(e,t){var a=function(e){var t,a,n=e.length;for(;0!==n;)a=Math.floor(Math.random()*n),t=e[n-=1],e[n]=e[a],e[a]=t;return e}(e);s(a.splice(0,t))}((e=2e3,t.filter((function(t){return t.distance<e/1e3}))),3)}),[t,a,l]),r.a.createElement(r.a.Fragment,null,r.a.createElement(O.a,{id:"restaurant-suggestions",display:"flex",flex:"1 0 auto",flexDirection:"row",flexWrap:"wrap"},r.a.createElement(O.a,{display:"flex",flexDirection:"column"},(i||Array.from(new Array(3))).map((function(e,t){return r.a.createElement(O.a,{key:t},r.a.createElement(j,{restaurant:e}))}))),r.a.createElement(D,{userLocation:a,restaurantSuggestions:i})))},N=function(){return r.a.createElement("div",null,r.a.createElement(E.a,{id:"page-header",variant:"h4",align:"center",gutterBottom:!0},"Lunch Near Me"))},R=a(136),A=a(51),B=Object(d.a)({root:{margin:"8px 16px"}}),I=function(e){var t=e.searchResult,a=e.fillFormWithData,n=B(),l=t.address.amenity,o=t.extratags.website,c="".concat(t.lat,",").concat(t.lon);return r.a.createElement(p.a,{className:n.root},r.a.createElement(b.a,null,r.a.createElement(E.a,{variant:"h5"},l),r.a.createElement(y.a,{href:o},o),r.a.createElement("br",null),r.a.createElement(x.a,{color:"primary",onClick:function(){return a(l,"",o,c)}},"Fill the data")))},z=function(e){var t=e.searchResults,a=e.fillFormWithData;return r.a.createElement(O.a,{id:"search-results",display:"flex",flexDirection:"row",justifyContent:"center"},t.map((function(e){return r.a.createElement(I,{key:e.place_id,searchResult:e,fillFormWithData:a})})))},V=function(e){return e*(Math.PI/180)},J=function(e){return{x1:e.lon-.45,y1:e.lat-.45,x2:e.lon+.45,y2:e.lat+.45}},Y=function(e){var t=e.userLocation,a=Object(n.useState)([]),l=Object(u.a)(a,2),o=l[0],c=l[1],m=function(){var e=Object(s.a)(i.a.mark((function e(a){var n,r,l,o,s,u,m;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=J(t),r=n.x1,l=n.y1,o=n.x2,s=n.y2,console.log("Bounding box: ",r,l,o,s),e.next=4,fetch("https://nominatim.openstreetmap.org/?addressdetails=1&q=".concat(a,"&format=json&limit=5&viewbox=").concat(r,",").concat(l,",").concat(o,",").concat(s,"&extratags=1&bounded=1"));case 4:return u=e.sent,e.next=7,u.json();case 7:(m=e.sent).length?(console.log(m),c(m)):alert("No search results found");case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),f=Object(A.a)({initialValues:{search:""},onSubmit:function(e){m(JSON.stringify(e.search))}}),d=Object(A.a)({initialValues:{name:"",subtitle:"",website:"",latlon:""},onSubmit:function(){var e=Object(s.a)(i.a.mark((function e(t){var a,n;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a={name:t.name,subtitle:t.subtitle,website:t.website,latlon:"(".concat(t.latlon,")")},e.next=3,h.a.post("/restaurants",a);case 3:n=e.sent,console.log("res.data: ",n.data);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()});return r.a.createElement(O.a,null,r.a.createElement(E.a,{variant:"h5"},"Add a new restaurant"),r.a.createElement("form",{onSubmit:f.handleSubmit},r.a.createElement("label",{htmlFor:"search"},"Search for a restaurant to add"),r.a.createElement("input",{id:"search",name:"search",type:"text",onChange:f.handleChange,value:f.values.search}),r.a.createElement("button",{type:"submit"},"Search")),r.a.createElement(z,{searchResults:o,fillFormWithData:function(e,t,a,n){d.setFieldValue("name",e),d.setFieldValue("subtitle",t),d.setFieldValue("website",a),d.setFieldValue("latlon",n)}}),r.a.createElement(E.a,{variant:"h6"},"Add manually"),r.a.createElement("form",{onSubmit:d.handleSubmit},r.a.createElement("label",{htmlFor:"name"},"Name"),r.a.createElement("input",{id:"name",name:"name",type:"text",onChange:d.handleChange,value:d.values.name}),r.a.createElement("br",null),r.a.createElement("label",{htmlFor:"subtitle"},"Specifier"),r.a.createElement("input",{id:"subtitle",name:"subtitle",type:"text",onChange:d.handleChange,value:d.values.subtitle}),r.a.createElement("br",null),r.a.createElement("label",{htmlFor:"website"},"Website"),r.a.createElement("input",{id:"website",name:"website",type:"text",onChange:d.handleChange,value:d.values.website}),r.a.createElement("br",null),r.a.createElement("label",{htmlFor:"latlon"},"Coordinates lat, lon"),r.a.createElement("input",{id:"latlon",name:"latlon",type:"text",onChange:d.handleChange,value:d.values.latlon}),r.a.createElement("br",null),r.a.createElement("button",{type:"submit"},"Add to database")))},q=a(71),T=a(9),Z=(a(134),function(){var e=Object(n.useState)(null),t=Object(u.a)(e,2),a=t[0],l=t[1],o=Object(n.useState)(null),c=Object(u.a)(o,2),m=c[0],d=c[1],p=Object(n.useState)(!1),b=Object(u.a)(p,2),E=b[0],g=b[1],x=Object(n.useState)(null),y=Object(u.a)(x,2),v=(y[0],y[1]);return Object(n.useEffect)((function(){(function(){var e=Object(s.a)(i.a.mark((function e(){var t;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,h.a.get("/restaurants");case 2:t=e.sent,l(t.data),console.log("Restaurants initialized");case 5:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}})()()}),[]),Object(n.useEffect)((function(){navigator.geolocation?(navigator.geolocation.getCurrentPosition((function(e){var t={lat:e.coords.latitude,lon:e.coords.longitude};v({message:null,type:null}),console.log("User location: ",t),d(t),g(!1)}),(function(){v({message:"Location is needed to show the restaurant suggestions.",type:"error"})})),v({message:"Locating...",type:"spinner"})):v({message:"Geolocation is not supported by your browser",type:"error"})}),[]),Object(n.useEffect)((function(){m&&a&&!E&&function(){var e=a.map((function(e){return e.distance=function(e,t,a,n){var r=V(a-e),l=V(n-t),o=Math.sin(r/2)*Math.sin(r/2)+Math.cos(V(e))*Math.cos(V(a))*Math.sin(l/2)*Math.sin(l/2);return(6371*(2*Math.atan2(Math.sqrt(o),Math.sqrt(1-o)))).toFixed(2)}(m.lat,m.lon,e.latlon.x,e.latlon.y),e}));l(e),g(!0),console.log("Distances added to restaurants")}()}),[m,a,E]),r.a.createElement(r.a.Fragment,null,r.a.createElement(f.a,null),r.a.createElement(R.a,{maxWidth:"md",style:{padding:"24px"}},r.a.createElement(O.a,{display:"flex",flexDirection:"column"},r.a.createElement(q.a,null,r.a.createElement(N,null),r.a.createElement(T.c,null,r.a.createElement(T.a,{path:"/addRestaurant"},r.a.createElement(Y,{userLocation:m})),r.a.createElement(T.a,{path:"/"},r.a.createElement(L,{restaurants:a,setRestaurants:l,userLocation:m,isWithDistance:E})))))))});a(105),a(106),a(107),a(108);o.a.render(r.a.createElement(r.a.StrictMode,null,r.a.createElement(Z,null)),document.getElementById("root"))},77:function(e,t,a){e.exports=a(109)}},[[77,1,2]]]);
//# sourceMappingURL=main.cb4c3471.chunk.js.map