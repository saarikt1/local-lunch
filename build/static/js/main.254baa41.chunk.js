(this.webpackJsonpfrontend=this.webpackJsonpfrontend||[]).push([[0],{109:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),l=a(26),o=a.n(l),c=a(29),i=a.n(c),s=a(35),u=a(23),m=a(37),d=a.n(m),h=a(132),f=a(125),p=a(138),b=a(126),E=a(111),g=a(127),y=Object(f.a)({root:{margin:"8px 16px"}}),x=function(e){var t=e.restaurant,a=y();return r.a.createElement(p.a,{className:a.root},r.a.createElement(b.a,null,r.a.createElement(E.a,{variant:"h5"},t.name),r.a.createElement(E.a,{variant:"subtitle2"},t.subtitle),r.a.createElement(g.a,{href:t.website},t.website),t.distance&&r.a.createElement("p",null,t.distance,"\xa0km from your position")))},v=function(e){return e*(Math.PI/180)},w=function(e,t){navigator.geolocation?(navigator.geolocation.getCurrentPosition((function(a){var n={lat:a.coords.latitude,lon:a.coords.longitude};t({message:null,type:null}),console.log("User location: ",n),e(n)}),(function(){t({message:"Location is needed to show the restaurant suggestions.",type:"error"})})),t({message:"Locating...",type:"spinner"})):t({message:"Geolocation is not supported by your browser",type:"error"})},j=function(e){return{x1:e.lon-.45,y1:e.lat-.45,x2:e.lon+.45,y2:e.lat+.45}},O=a(134),S=a(139),F=a(140),M=a(137),C=a(128),k=a(129),D=a(130),L=function(e){var t=e.userLocation,a=e.restaurantSuggestions;return r.a.createElement(r.a.Fragment,null,r.a.createElement(O.a,{id:"map",flex:"1",margin:"20px"},r.a.createElement(S.a,{bounds:function(e,t){console.log("restaurantSuggestions: ",e);var a=e.reduce((function(e,t){return Math.max(e,t.latlon.x)}),t.lat),n=e.reduce((function(e,t){return Math.min(e,t.latlon.y)}),t.lon),r=e.reduce((function(e,t){return Math.min(e,t.latlon.x)}),t.lat);return[[a,e.reduce((function(e,t){return Math.max(e,t.latlon.y)}),t.lon)],[r,n]]}(a,t),boundsOptions:{padding:[35,35]},scrollWheelZoom:!1,style:{width:"100%",height:"500px"}},r.a.createElement(F.a,{url:"https://api.mapbox.com/styles/v1/mapbox/streets-v11/tiles/256/{z}/{x}/{y}?access_token=".concat("pk.eyJ1IjoidG9tbWlzIiwiYSI6ImNrY2FjMXZoazFkZmoyc3A4MzR6NHhta3UifQ.FEItf-Tx4knfi3RtN88_FA"),attribution:'\xa9 <a href="https://www.openstreetmap.org/">OpenStreetMap</a>, <a href="https://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, \xa9 <a href="https://www.mapbox.com/">Mapbox</a>'}),t&&r.a.createElement(M.a,{center:t,radius:15},r.a.createElement(C.a,null,r.a.createElement(E.a,{variant:"subtitle1"},"Your location"))),a&&a.map((function(e){return r.a.createElement(k.a,{key:e.id,position:[e.latlon.x,e.latlon.y]},r.a.createElement(D.a,{permanent:!0},e.name),r.a.createElement(C.a,null,r.a.createElement(E.a,{variant:"h6"},e.name),r.a.createElement(g.a,{href:e.website},e.website)))})))))},R=function(e){var t=e.restaurants,a=e.setRestaurants,l=e.userLocation,o=Object(n.useState)(!1),c=Object(u.a)(o,2),i=c[0],s=c[1],m=Object(n.useState)(null),d=Object(u.a)(m,2),h=d[0],f=d[1];return Object(n.useEffect)((function(){var e;l&&!i&&(!function(){var e=t.map((function(e){return e.distance=function(e,t,a,n){var r=v(a-e),l=v(n-t),o=Math.sin(r/2)*Math.sin(r/2)+Math.cos(v(e))*Math.cos(v(a))*Math.sin(l/2)*Math.sin(l/2);return(6371*(2*Math.atan2(Math.sqrt(o),Math.sqrt(1-o)))).toFixed(2)}(l.lat,l.lon,e.latlon.x,e.latlon.y),e}));a(e),s(!0)}(),function(e,t){var a=function(e){var t,a,n=e.length;for(;0!==n;)a=Math.floor(Math.random()*n),t=e[n-=1],e[n]=e[a],e[a]=t;return e}(e);f(a.splice(0,t))}((e=700,t.filter((function(t){return t.distance<e/1e3}))),3))}),[t,a,l,i]),r.a.createElement(r.a.Fragment,null,h&&r.a.createElement(O.a,{id:"restaurant-suggestions",display:"flex",flexDirection:"row",justifyContent:"flex-start",style:{border:"1px solid blue"}},r.a.createElement(O.a,{display:"flex",flexDirection:"column"},h.map((function(e){return r.a.createElement(O.a,{key:e.id},r.a.createElement(x,{restaurant:e}))}))),r.a.createElement(L,{userLocation:l,restaurantSuggestions:h})))},N=function(){return r.a.createElement("div",null,r.a.createElement(E.a,{id:"page-header",variant:"h4",align:"center",gutterBottom:!0},"Local Lunch"),r.a.createElement(E.a,{id:"subtitle",variant:"subtitle1",align:"center",gutterBottom:!0},"Here's the help you need to choose where to go for lunch today."))},W=a(133),A=a(135),I=a(52),V=Object(f.a)({root:{margin:"8px 16px"}}),B=function(e){var t=e.searchResult,a=e.fillFormWithData,n=V(),l=t.address.amenity,o=t.extratags.website,c="".concat(t.lat,",").concat(t.lon);return r.a.createElement(p.a,{className:n.root},r.a.createElement(b.a,null,r.a.createElement(E.a,{variant:"h5"},l),r.a.createElement(g.a,{href:o},o),r.a.createElement("br",null),r.a.createElement(A.a,{color:"primary",onClick:function(){return a(l,"",o,c)}},"Fill the data")))},z=function(e){var t=e.searchResults,a=e.fillFormWithData;return r.a.createElement(O.a,{id:"search-results",display:"flex",flexDirection:"row",justifyContent:"center"},t.map((function(e){return r.a.createElement(B,{key:e.place_id,searchResult:e,fillFormWithData:a})})))},J=function(e){var t=e.userLocation,a=Object(n.useState)([]),l=Object(u.a)(a,2),o=l[0],c=l[1],m=function(){var e=Object(s.a)(i.a.mark((function e(a){var n,r,l,o,s,u,m;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=j(t),r=n.x1,l=n.y1,o=n.x2,s=n.y2,console.log("Bounding box: ",r,l,o,s),e.next=4,fetch("https://nominatim.openstreetmap.org/?addressdetails=1&q=".concat(a,"&format=json&limit=5&viewbox=").concat(r,",").concat(l,",").concat(o,",").concat(s,"&extratags=1&bounded=1"));case 4:return u=e.sent,e.next=7,u.json();case 7:(m=e.sent).length?(console.log(m),c(m)):alert("No search results found");case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),h=Object(I.a)({initialValues:{search:""},onSubmit:function(e){m(JSON.stringify(e.search))}}),f=Object(I.a)({initialValues:{name:"",subtitle:"",website:"",latlon:""},onSubmit:function(){var e=Object(s.a)(i.a.mark((function e(t){var a,n;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a={name:t.name,subtitle:t.subtitle,website:t.website,latlon:"(".concat(t.latlon,")")},e.next=3,d.a.post("/restaurants",a);case 3:n=e.sent,console.log("res.data: ",n.data);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()});return r.a.createElement(O.a,null,r.a.createElement(E.a,{variant:"h5"},"Add a new restaurant"),r.a.createElement("form",{onSubmit:h.handleSubmit},r.a.createElement("label",{htmlFor:"search"},"Search for a restaurant to add"),r.a.createElement("input",{id:"search",name:"search",type:"text",onChange:h.handleChange,value:h.values.search}),r.a.createElement("button",{type:"submit"},"Search")),r.a.createElement(z,{searchResults:o,fillFormWithData:function(e,t,a,n){f.setFieldValue("name",e),f.setFieldValue("subtitle",t),f.setFieldValue("website",a),f.setFieldValue("latlon",n)}}),r.a.createElement(E.a,{variant:"h6"},"Add manually"),r.a.createElement("form",{onSubmit:f.handleSubmit},r.a.createElement("label",{htmlFor:"name"},"Name"),r.a.createElement("input",{id:"name",name:"name",type:"text",onChange:f.handleChange,value:f.values.name}),r.a.createElement("br",null),r.a.createElement("label",{htmlFor:"subtitle"},"Specifier"),r.a.createElement("input",{id:"subtitle",name:"subtitle",type:"text",onChange:f.handleChange,value:f.values.subtitle}),r.a.createElement("br",null),r.a.createElement("label",{htmlFor:"website"},"Website"),r.a.createElement("input",{id:"website",name:"website",type:"text",onChange:f.handleChange,value:f.values.website}),r.a.createElement("br",null),r.a.createElement("label",{htmlFor:"latlon"},"Coordinates lat, lon"),r.a.createElement("input",{id:"latlon",name:"latlon",type:"text",onChange:f.handleChange,value:f.values.latlon}),r.a.createElement("br",null),r.a.createElement("button",{type:"submit"},"Add to database")))},Y=a(47),q=a(9),Z=a(131),_=function(e){var t=e.notification;return null===t?null:"spinner"===t.type?r.a.createElement("div",null,t.message,r.a.createElement(Z.a,null)):r.a.createElement("div",null,t.message)},G=function(){var e=Object(n.useState)(null),t=Object(u.a)(e,2),a=t[0],l=t[1],o=Object(n.useState)(null),c=Object(u.a)(o,2),m=c[0],f=c[1],p=Object(n.useState)(null),b=Object(u.a)(p,2),E=b[0],g=b[1];return Object(n.useEffect)((function(){(function(){var e=Object(s.a)(i.a.mark((function e(){var t;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,d.a.get("/restaurants");case 2:t=e.sent,l(t.data);case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}})()()}),[]),r.a.createElement(r.a.Fragment,null,r.a.createElement(h.a,null),r.a.createElement(W.a,{maxWidth:"md",style:{border:"1px solid red",padding:"30px"}},r.a.createElement(Y.a,null,r.a.createElement(N,null),r.a.createElement(O.a,{display:"flex",flexDirection:"row",justifyContent:"center"},r.a.createElement(Y.b,{to:"/",style:{textDecoration:"none"}},r.a.createElement(A.a,{id:"locate-button",variant:"contained",color:"primary",disableElevation:!0,type:"button",onClick:function(){return w(f,g)},style:{margin:"20px"}},"Show me my options")),r.a.createElement(Y.b,{to:"/addRestaurant",style:{textDecoration:"none"}},r.a.createElement(A.a,{id:"add-restaurant-button",variant:"contained",color:"secondary",disableElevation:!0,type:"button",style:{margin:"20px"},onClick:function(){return w(f,g)}},"Add a new restaurant"))),r.a.createElement(q.c,null,r.a.createElement(q.a,{path:"/addRestaurant"},r.a.createElement(J,{userLocation:m})),r.a.createElement(q.a,{path:"/"},r.a.createElement(_,{notification:E}),m&&r.a.createElement(R,{restaurants:a,setRestaurants:l,userLocation:m}))))))};a(105),a(106),a(107),a(108);o.a.render(r.a.createElement(r.a.StrictMode,null,r.a.createElement(G,null)),document.getElementById("root"))},77:function(e,t,a){e.exports=a(109)}},[[77,1,2]]]);
//# sourceMappingURL=main.254baa41.chunk.js.map