(this.webpackJsonpfrontend=this.webpackJsonpfrontend||[]).push([[0],{117:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),l=a(18),o=a.n(l),c=a(31),i=a.n(c),u=a(38),s=a(19),m=a(42),f=a.n(m),h=a(152),d=a(142),b=a(143),p=a(144),E=a(120),g=a(146),v=a(147),x=a(148),y=a(145),w=Object(d.a)({root:{maxWidth:300,minWidth:300,margin:"8px 16px"},media:{height:140},bullet:{display:"inline-block",margin:"0 4px"}}),j=function(e){var t=e.restaurant,a=w();a.bullet;return r.a.createElement(b.a,{className:a.root},r.a.createElement(p.a,null,r.a.createElement(E.a,{gutterBottom:!0,variant:"h5",component:"h2"},t?t.name:r.a.createElement(y.a,null))),r.a.createElement(g.a,null,t?r.a.createElement(v.a,{size:"small",color:"primary"},t.website&&r.a.createElement(x.a,{href:t.website},"Website")):r.a.createElement(y.a,{variant:"rect",width:56,height:22,style:{marginLeft:"8px",marginBottom:"8px"}})))},O=a(154),S=a(158),F=a(159),M=a(157),C=a(149),k=a(150),W=a(151),N=function(e){var t=e.userLocation,a=e.restaurantSuggestions,l=Object(n.useState)([[62.9894714,34.558059],[38.1706012,-3.976497]]),o=Object(s.a)(l,2),c=o[0],i=o[1],u=Object(n.useRef)();return Object(n.useEffect)((function(){u.current.leafletElement.invalidateSize()})),Object(n.useEffect)((function(){t&&function(){if(a){var e=a.reduce((function(e,t){return Math.max(e,t.latlon.x)}),t.lat),n=a.reduce((function(e,t){return Math.min(e,t.latlon.y)}),t.lon),r=a.reduce((function(e,t){return Math.min(e,t.latlon.x)}),t.lat),l=a.reduce((function(e,t){return Math.max(e,t.latlon.y)}),t.lon);i([[e,l],[r,n]])}else i([[t.lat,t.lon],[t.lat,t.lon]])}()}),[a,i,t]),r.a.createElement(r.a.Fragment,null,r.a.createElement(O.a,{id:"map",flex:"1",padding:"8px"},r.a.createElement(S.a,{ref:u,useFlyTo:"true",bounds:c,boundsOptions:{padding:[35,35]},scrollWheelZoom:!1,style:{width:"100%",height:"500px"}},r.a.createElement(F.a,{url:"https://api.mapbox.com/styles/v1/mapbox/streets-v11/tiles/256/{z}/{x}/{y}?access_token=".concat("pk.eyJ1IjoidG9tbWlzIiwiYSI6ImNrY2FjMXZoazFkZmoyc3A4MzR6NHhta3UifQ.FEItf-Tx4knfi3RtN88_FA"),attribution:'\xa9 <a href="https://www.openstreetmap.org/">OpenStreetMap</a>, <a href="https://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, \xa9 <a href="https://www.mapbox.com/">Mapbox</a>'}),t&&r.a.createElement(M.a,{center:t,radius:15},r.a.createElement(C.a,null,r.a.createElement(E.a,{variant:"subtitle1"},"Your location"))),a&&a.map((function(e){return r.a.createElement(k.a,{key:e.id,position:[e.latlon.x,e.latlon.y]},r.a.createElement(W.a,{permanent:!0},e.name),r.a.createElement(C.a,null,r.a.createElement(E.a,{variant:"h6"},e.name),r.a.createElement(x.a,{href:e.website},e.website)))})))))},D=function(e){var t=e.restaurants,a=e.userLocation,l=e.isWithDistance,o=e.setNotification,c=Object(n.useState)(),i=Object(s.a)(c,2),u=i[0],m=i[1],f=Object(n.useState)(!0),h=Object(s.a)(f,2),d=h[0],b=h[1];return Object(n.useEffect)((function(){var e=!1;if(t&&a&&l){var n=function a(n){var r=t.filter((function(e){return e.distance<n/1e3}));return!e&&r.length<2?(e=!0,a(2e3)):0===r.length?null:r}(700);n?function(e,t){var a=function(e){var t,a,n=e.length;for(;0!==n;)a=Math.floor(Math.random()*n),t=e[n-=1],e[n]=e[a],e[a]=t;return e}(e);m(a.splice(0,t))}(n,3):(o({message:"No restaurants found near your location. Try refreshing the page at a different location.",type:"error"}),b(!1))}}),[t,a,l,o]),r.a.createElement(r.a.Fragment,null,r.a.createElement(O.a,{id:"restaurant-suggestions",display:"flex",flex:"1 0 auto",flexDirection:"row",flexWrap:"wrap"},d&&r.a.createElement(O.a,{display:"flex",flexDirection:"column"},(u||Array.from(new Array(3))).map((function(e,t){return r.a.createElement(O.a,{key:t},r.a.createElement(j,{restaurant:e}))}))),r.a.createElement(N,{userLocation:a,restaurantSuggestions:u})))},L=function(){return r.a.createElement("div",null,r.a.createElement(E.a,{id:"page-header",variant:"h4",align:"center",gutterBottom:!0},"Lunch Near Me"))},R=a(153),A=a(58),z=Object(d.a)({root:{margin:"8px 16px"}}),I=function(e){var t=e.searchResult,a=e.fillFormWithData,n=z(),l=t.address.amenity,o=t.extratags.website,c="".concat(t.lat,",").concat(t.lon);return r.a.createElement(b.a,{className:n.root},r.a.createElement(p.a,null,r.a.createElement(E.a,{variant:"h5"},l),r.a.createElement(x.a,{href:o},o),r.a.createElement("br",null),r.a.createElement(v.a,{color:"primary",onClick:function(){return a(l,"",o,c)}},"Fill the data")))},B=function(e){var t=e.searchResults,a=e.fillFormWithData;return r.a.createElement(O.a,{id:"search-results",display:"flex",flexDirection:"row",justifyContent:"center"},t.map((function(e){return r.a.createElement(I,{key:e.place_id,searchResult:e,fillFormWithData:a})})))},V=function(e){return e*(Math.PI/180)},J=function(e){return{x1:e.lon-.45,y1:e.lat-.45,x2:e.lon+.45,y2:e.lat+.45}},T=function(e){var t=e.userLocation,a=Object(n.useState)([]),l=Object(s.a)(a,2),o=l[0],c=l[1],m=function(){var e=Object(u.a)(i.a.mark((function e(a){var n,r,l,o,u,s,m;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=J(t),r=n.x1,l=n.y1,o=n.x2,u=n.y2,console.log("Bounding box: ",r,l,o,u),e.next=4,fetch("https://nominatim.openstreetmap.org/?addressdetails=1&q=".concat(a,"&format=json&limit=5&viewbox=").concat(r,",").concat(l,",").concat(o,",").concat(u,"&extratags=1&bounded=1"));case 4:return s=e.sent,e.next=7,s.json();case 7:(m=e.sent).length?(console.log(m),c(m)):alert("No search results found");case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),h=Object(A.a)({initialValues:{search:""},onSubmit:function(e){m(JSON.stringify(e.search))}}),d=Object(A.a)({initialValues:{name:"",subtitle:"",website:"",latlon:""},onSubmit:function(){var e=Object(u.a)(i.a.mark((function e(t){var a,n;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a={name:t.name,subtitle:t.subtitle,website:t.website,latlon:"(".concat(t.latlon,")")},e.next=3,f.a.post("/restaurants",a);case 3:n=e.sent,console.log("res.data: ",n.data);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()});return r.a.createElement(O.a,null,r.a.createElement(E.a,{variant:"h5"},"Add a new restaurant"),r.a.createElement("form",{onSubmit:h.handleSubmit},r.a.createElement("label",{htmlFor:"search"},"Search for a restaurant to add"),r.a.createElement("input",{id:"search",name:"search",type:"text",onChange:h.handleChange,value:h.values.search}),r.a.createElement("button",{type:"submit"},"Search")),r.a.createElement(B,{searchResults:o,fillFormWithData:function(e,t,a,n){d.setFieldValue("name",e),d.setFieldValue("subtitle",t),d.setFieldValue("website",a),d.setFieldValue("latlon",n)}}),r.a.createElement(E.a,{variant:"h6"},"Add manually"),r.a.createElement("form",{onSubmit:d.handleSubmit},r.a.createElement("label",{htmlFor:"name"},"Name"),r.a.createElement("input",{id:"name",name:"name",type:"text",onChange:d.handleChange,value:d.values.name}),r.a.createElement("br",null),r.a.createElement("label",{htmlFor:"subtitle"},"Specifier"),r.a.createElement("input",{id:"subtitle",name:"subtitle",type:"text",onChange:d.handleChange,value:d.values.subtitle}),r.a.createElement("br",null),r.a.createElement("label",{htmlFor:"website"},"Website"),r.a.createElement("input",{id:"website",name:"website",type:"text",onChange:d.handleChange,value:d.values.website}),r.a.createElement("br",null),r.a.createElement("label",{htmlFor:"latlon"},"Coordinates lat, lon"),r.a.createElement("input",{id:"latlon",name:"latlon",type:"text",onChange:d.handleChange,value:d.values.latlon}),r.a.createElement("br",null),r.a.createElement("button",{type:"submit"},"Add to database")))},Y=a(77),q=a(10),Z=a(155),_=a(156);function G(e){return r.a.createElement(_.a,Object.assign({elevation:6,variant:"filled"},e))}var H=Object(d.a)((function(e){return{root:{width:"100%","& > * + *":{marginTop:e.spacing(2)}}}})),P=function(e){var t=e.notification,a=H(),l=Object(n.useState)(!0),o=Object(s.a)(l,2),c=o[0],i=o[1],u=function(e,t){"clickaway"!==t&&i(!1)};return null===t?null:r.a.createElement("div",{className:a.root},r.a.createElement(Z.a,{open:c,autoHideDuration:6e3,onClose:u,anchorOrigin:{vertical:"top",horizontal:"center"}},r.a.createElement(G,{onClose:u,severity:"warning"},t.message)))},Q=function(){var e=Object(n.useState)(null),t=Object(s.a)(e,2),a=t[0],l=t[1],o=Object(n.useState)(null),c=Object(s.a)(o,2),m=c[0],d=c[1],b=Object(n.useState)(!1),p=Object(s.a)(b,2),E=p[0],g=p[1],v=Object(n.useState)(null),x=Object(s.a)(v,2),y=x[0],w=x[1];return Object(n.useEffect)((function(){(function(){var e=Object(u.a)(i.a.mark((function e(){var t;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,f.a.get("/restaurants");case 2:t=e.sent,l(t.data);case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}})()()}),[]),Object(n.useEffect)((function(){navigator.geolocation?navigator.geolocation.getCurrentPosition((function(e){var t={lat:e.coords.latitude,lon:e.coords.longitude};w(null),d(t),g(!1)}),(function(){w({message:"Location is needed to show the restaurant suggestions.",type:"error"})})):w({message:"Geolocation is not supported by your browser",type:"error"})}),[]),Object(n.useEffect)((function(){m&&a&&!E&&function(){var e=a.map((function(e){return e.distance=function(e,t,a,n){var r=V(a-e),l=V(n-t),o=Math.sin(r/2)*Math.sin(r/2)+Math.cos(V(e))*Math.cos(V(a))*Math.sin(l/2)*Math.sin(l/2);return(6371*(2*Math.atan2(Math.sqrt(o),Math.sqrt(1-o)))).toFixed(2)}(m.lat,m.lon,e.latlon.x,e.latlon.y),e}));l(e),g(!0)}()}),[m,a,E]),r.a.createElement(r.a.Fragment,null,r.a.createElement(h.a,null),r.a.createElement(R.a,{maxWidth:"md",style:{padding:"24px"}},r.a.createElement(O.a,{display:"flex",flexDirection:"column"},r.a.createElement(Y.a,null,r.a.createElement(L,null),r.a.createElement(q.c,null,r.a.createElement(q.a,{path:"/addRestaurant"},r.a.createElement(T,{userLocation:m})),r.a.createElement(q.a,{path:"/"},r.a.createElement(P,{notification:y}),r.a.createElement(D,{restaurants:a,setRestaurants:l,userLocation:m,isWithDistance:E,setNotification:w})))))))};a(113),a(114),a(115),a(116);o.a.render(r.a.createElement(Q,null),document.getElementById("root"))},85:function(e,t,a){e.exports=a(117)}},[[85,1,2]]]);
//# sourceMappingURL=main.acf991d5.chunk.js.map