(this.webpackJsonpfrontend=this.webpackJsonpfrontend||[]).push([[0],{157:function(e,t,a){e.exports=a(189)},189:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),c=a(12),i=a.n(c),o=a(237),l=a(224),s=a(239),u=a(226),m=a(228),d=a(192),f=a(230),p=a(231),b=a(232),h=a(229),g=Object(l.a)({root:{maxWidth:296,minWidth:250,margin:"8px 8px"},bullet:{display:"inline-block",margin:"0 4px"},skeleton:{marginLeft:"8px",marginBottom:"8px"}}),E=function(e){var t=e.restaurant,a=g();return n.createElement(u.a,{className:a.root},n.createElement(m.a,null,n.createElement(d.a,{gutterBottom:!0,variant:"h5",component:"h2"},t?t.name:n.createElement(h.a,null))),n.createElement(f.a,null,t?n.createElement(p.a,{size:"small",color:"primary"},t.website&&n.createElement(b.a,{href:t.website},"Website")):n.createElement(h.a,{variant:"rect",width:56,height:22,className:a.skeleton})))},v=function(e){var t=e.restaurantSuggestions,a=e.locationState,n=Array.from(new Array(3));return r.a.createElement(s.a,{display:"flex",flexDirection:"column"},!a.error&&(t||n).map((function(e,t){return r.a.createElement(s.a,{key:t},r.a.createElement(E,{restaurant:e}))})))},y=a(87),x=a(244),j=a(245),w=a(243),O=a(233),F=a(234),S=a(235),M=a(24),N=a(14),k=Object(l.a)({map:{width:"100%",minWidth:"250px",paddingBottom:"min(75%, 80vh)"}}),W=function(e){var t=e.restaurantSuggestions,a=N.latLngBounds(N.latLng(62.9894714,34.558059),N.latLng(38.1706012,-3.976497)),c=Object(n.useState)(a),i=Object(y.a)(c,2),o=i[0],l=i[1],u=Object(n.useRef)(),m=k(),f=Object(M.c)((function(e){return e.location.coordinates}));return Object(n.useEffect)((function(){u.current.leafletElement.invalidateSize()})),Object(n.useEffect)((function(){f&&function(){if(t){var e=t.reduce((function(e,t){return Math.max(e,t.latlon.x)}),f.lat),a=t.reduce((function(e,t){return Math.min(e,t.latlon.y)}),f.lng),n=t.reduce((function(e,t){return Math.min(e,t.latlon.x)}),f.lat),r=t.reduce((function(e,t){return Math.max(e,t.latlon.y)}),f.lng);l(N.latLngBounds(N.latLng(e,r),N.latLng(n,a)))}else l(N.latLngBounds(N.latLng(f.lat,f.lng),N.latLng(f.lat,f.lng)))}()}),[t,l,f]),r.a.createElement(r.a.Fragment,null,r.a.createElement(s.a,{id:"map",flex:"1",margin:"8px"},r.a.createElement(x.a,{ref:u,bounds:o,boundsOptions:{padding:[35,35]},scrollWheelZoom:!1,className:m.map},r.a.createElement(j.a,{url:"https://api.mapbox.com/styles/v1/mapbox/streets-v11/tiles/256/{z}/{x}/{y}?access_token=".concat("pk.eyJ1IjoidG9tbWlzIiwiYSI6ImNrY2FjMXZoazFkZmoyc3A4MzR6NHhta3UifQ.FEItf-Tx4knfi3RtN88_FA"),attribution:'\xa9 <a href="https://www.openstreetmap.org/">OpenStreetMap</a>, <a href="https://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, \xa9 <a href="https://www.mapbox.com/">Mapbox</a>'}),f&&r.a.createElement(w.a,{center:f,radius:15},r.a.createElement(O.a,null,r.a.createElement(d.a,{variant:"subtitle1"},"Your location"))),t&&t.map((function(e){return r.a.createElement(F.a,{key:e.id,position:[e.latlon.x,e.latlon.y]},r.a.createElement(S.a,{permanent:!0},e.name),r.a.createElement(O.a,null,r.a.createElement(d.a,{variant:"h6"},e.name),e.website&&r.a.createElement(b.a,{href:e.website},e.website)))})))))},R=function(){var e=Object(M.c)((function(e){return e.restaurants.restaurantSuggestions})),t=Object(M.c)((function(e){return e.location}));return r.a.createElement(r.a.Fragment,null,r.a.createElement(s.a,{id:"restaurant-suggestions",display:"flex",flex:"1 0 auto",justifyContent:"center",flexDirection:"row",flexWrap:"wrap"},r.a.createElement(v,{restaurantSuggestions:e,locationState:t}),r.a.createElement(W,{restaurantSuggestions:e})))},I=function(){return r.a.createElement(d.a,{id:"page-header",variant:"h4",align:"center",gutterBottom:!0},"Lunch Near Me")},D=a(238),L=a(31),C=a.n(L),q=a(44),A=a(28),z=Object(l.a)({root:{margin:"8px 16px"}}),B=function(e){var t=e.searchResult,a=e.fillFormWithData,n=z(),c=t.address.amenity,i=t.extratags.website||"",o="".concat(t.lat,",").concat(t.lng),l=[t.address.road," ",t.address.house_number].join(""),s=[t.address.postcode," ",t.address.city||t.address.town,", ",t.address.country].join("");return r.a.createElement(u.a,{className:n.root},r.a.createElement(m.a,null,r.a.createElement(d.a,{variant:"h5"},c),r.a.createElement(b.a,{href:i},i),r.a.createElement(d.a,{variant:"body1"},l,r.a.createElement("br",null),s),r.a.createElement("br",null),r.a.createElement(p.a,{color:"primary",onClick:function(){return a(c,"",i,o)}},"Fill the data")))},T=function(e){var t=e.searchResults,a=e.fillFormWithData;return r.a.createElement(s.a,{id:"search-results",display:"flex",flexDirection:"row",justifyContent:"center"},t.map((function(e){return r.a.createElement(B,{key:e.place_id,searchResult:e,fillFormWithData:a})})))},P=a(140),J=function(e){return e*(Math.PI/180)},Y=function(e){return{x1:e.lng-.45,y1:e.lat-.45,x2:e.lng+.45,y2:e.lat+.45}},_=a(80),G=a(106),H=a.n(G),V=a(88),Z=a(16),Q={msg:"",notificationType:"success",open:!1},U=function(e,t){return{type:"[notification] showNotification",data:{msg:e,notificationType:t,open:!0}}},X=Object(l.a)({textField:{minWidth:"250px"}}),K=function(){var e=Object(M.c)((function(e){return e.location.coordinates})),t=Object(n.useState)([]),a=Object(y.a)(t,2),c=a[0],i=a[1],o=Object(n.useState)({name:"",subtitle:"",website:"",latlon:""}),l=Object(y.a)(o,2),u=l[0],m=l[1],f=X(),b=Object(M.b)(),h=function(){var t=Object(q.a)(C.a.mark((function t(a){var n,r,c,o,l,s,u;return C.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=Y(e),r=n.x1,c=n.y1,o=n.x2,l=n.y2,t.next=3,fetch("https://nominatim.openstreetmap.org/?addressdetails=1&q=".concat(a,"&format=json&limit=5&viewbox=").concat(r,",").concat(c,",").concat(o,",").concat(l,"&extratags=1&bounded=1"));case 3:return s=t.sent,t.next=6,s.json();case 6:(u=t.sent).length?(console.log(u),i(u)):alert("No search results found");case 8:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}();return r.a.createElement(s.a,null,r.a.createElement(d.a,{variant:"h4"},"Add a new restaurant"),r.a.createElement(A.c,{initialValues:{search:""},onSubmit:function(e,t){var a=t.resetForm;h(JSON.stringify(e.search)),a(),b(U("Search done!","success"))}},r.a.createElement(A.b,null,r.a.createElement("label",{htmlFor:"search"},"Search for a restaurant from Open Street Map data"),r.a.createElement("br",null),r.a.createElement(A.a,{component:_.a,className:f.textField,label:"Restaurant name",name:"search",type:"text"}),r.a.createElement("br",null),r.a.createElement(p.a,{color:"primary",type:"submit"},"Search"))),r.a.createElement(T,{searchResults:c,fillFormWithData:function(e,t,a,n){m({name:e,subtitle:t,website:a,latlon:n})}}),r.a.createElement(d.a,{variant:"h6"},"Add manually"),r.a.createElement(A.c,{enableReinitialize:!0,initialValues:u,validationSchema:V.a({name:V.b().max(40,"Must be 40 characters or less").required("Required"),website:V.b().url("Must be a valid url"),latlon:V.b().required("Required")}),onSubmit:function(){var e=Object(q.a)(C.a.mark((function e(t,a){var n,r;return C.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=a.resetForm,r={name:t.name,subtitle:t.subtitle,website:t.website,latlon:"(".concat(t.latlon,")")},e.next=4,H.a.post("/restaurants",r);case 4:b(U("Restaurant ".concat(t.name," added to the database!"),"success")),n();case 6:case"end":return e.stop()}}),e)})));return function(t,a){return e.apply(this,arguments)}}()},(function(e){return r.a.createElement(A.b,null,r.a.createElement(A.a,{component:_.a,className:f.textField,label:"Name",name:"name",type:"text"}),r.a.createElement("br",null),r.a.createElement(A.a,{component:_.a,className:f.textField,label:"Specifier",name:"subtitle",type:"text"}),r.a.createElement("br",null),r.a.createElement(A.a,{component:_.a,className:f.textField,label:"Website",name:"website",type:"text"}),r.a.createElement("br",null),r.a.createElement(A.a,{component:_.a,className:f.textField,label:"Coordinates lat, lng",name:"latlon",type:"text"}),r.a.createElement("br",null),r.a.createElement(p.a,{type:"submit",variant:"contained",color:"primary",disableElevation:!0,disabled:!e.isValid},"Add restaurant"))})))},$=a(137),ee=a(18),te=a(242),ae=a(240);function ne(e){return r.a.createElement(ae.a,Object.assign({elevation:6,variant:"filled"},e))}var re=Object(l.a)((function(e){return{root:{width:"100%","& > * + *":{marginTop:e.spacing(2)}}}})),ce=function(){var e=Object(M.c)((function(e){return e.notification})),t=re(),a=Object(M.b)(),n=function(e){a({type:"[notification] hideNotification",data:{open:!1}})};return r.a.createElement("div",{id:"notificationContainer",className:t.root},r.a.createElement(te.a,{open:e.open,autoHideDuration:6e3,onClose:n,anchorOrigin:{vertical:"top",horizontal:"center"}},r.a.createElement(ne,{onClose:n,severity:e.notificationType},e.msg)))},ie={coordinates:{lat:60.16592,lng:24.94801},isLocating:!1,didInvalidate:!1,error:!1},oe=function(e){return{type:"[location] Fetch success",coords:{lat:e.coords.latitude,lng:e.coords.longitude}}},le=function(){var e={enableHighAccuracy:!1,maximumAge:3e4,timeout:5e3};return new Promise((function(t,a){navigator.geolocation.getCurrentPosition(t,a,e)}))},se="[restaurants] Distances added",ue={allRestaurants:[],isFetching:!1,isWithDistance:!1,didInvalidate:!1,restaurantSuggestions:[]},me=function(){return function(e,t){var a=t(),n=a.restaurants,r=a.location,c=n.allRestaurants.map((function(e){return e.distance=function(e,t,a,n){var r=J(a-e),c=J(n-t),i=Math.sin(r/2)*Math.sin(r/2)+Math.cos(J(e))*Math.cos(J(a))*Math.sin(c/2)*Math.sin(c/2),o=2*Math.atan2(Math.sqrt(i),Math.sqrt(1-i));return 1e3*Number((6371*o).toFixed(3))}(r.coordinates.lat,r.coordinates.lng,e.latlon.x,e.latlon.y),e}));e({type:se,payload:c})}},de=function(){return function(e,t){var a=[];0===(a=(a=function(e){for(var t,a,n=Object(P.a)(e),r=n.length;0!==r;)a=Math.floor(Math.random()*r),t=n[r-=1],n[r]=n[a],n[a]=t;return n}(a=function(e,t){return e.filter((function(e){return e.distance<t}))}(t().restaurants.allRestaurants,750))).splice(0,3)).length&&e(U("No restaurants found near your location.","warning")),e({type:"[restaurants] Set suggestions",payload:a})}},fe=Object(l.a)({root:{padding:"24px"}}),pe=function(){var e=Object(M.b)(),t=fe();return Object(n.useEffect)((function(){e(function(){var e=Object(q.a)(C.a.mark((function e(t){return C.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,Promise.all([t(function(){var e=Object(q.a)(C.a.mark((function e(t){var a;return C.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t({type:"[location] Fetch request"}),e.prev=1,navigator.geolocation){e.next=5;break}throw t(U("Geolocation is not supported by your browser","warning")),new Error("Geolocation not supported");case 5:return e.next=7,le();case 7:if(!((a=e.sent).coords.accuracy>1e3)){e.next=13;break}throw t(U("Couldn't get an accurate location. Maybe try with a different browser.","warning")),new Error("Poor accuracy for location");case 13:t(oe(a));case 14:return e.abrupt("return",a);case 17:if(e.prev=17,e.t0=e.catch(1),t({type:"[location] Fetch failure"}),2!==e.t0.code){e.next=23;break}throw t(U("Couldn't get location.","warning")),new Error("Location unavailable");case 23:throw e.t0;case 24:case"end":return e.stop()}}),e,null,[[1,17]])})));return function(t){return e.apply(this,arguments)}}()),t(function(){var e=Object(q.a)(C.a.mark((function e(t){var a;return C.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t({type:"[restaurants] Fetch request"}),e.prev=1,e.next=4,H.a.get("/restaurants");case 4:return(a=e.sent).data.forEach((function(e){e.distance=0})),t({type:"[restaurants] Fetch success",payload:a.data}),e.abrupt("return",a);case 10:e.prev=10,e.t0=e.catch(1),t({type:"[restaurants] Fetch failure",payload:"Couldn't fetch restaurants"});case 13:case"end":return e.stop()}}),e,null,[[1,10]])})));return function(t){return e.apply(this,arguments)}}())]);case 3:t(me()),t(de()),e.next=10;break;case 7:e.prev=7,e.t0=e.catch(0),console.error("Error initializing data: ",e.t0.message);case 10:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(t){return e.apply(this,arguments)}}())}),[e]),r.a.createElement(r.a.Fragment,null,r.a.createElement(o.a,null),r.a.createElement(D.a,{maxWidth:"lg",className:t.root},r.a.createElement(s.a,{display:"flex",flexDirection:"column"},r.a.createElement($.a,null,r.a.createElement(I,null),r.a.createElement(ce,null),r.a.createElement(ee.c,null,r.a.createElement(ee.a,{path:"/addRestaurant"},r.a.createElement(K,null)),r.a.createElement(ee.a,{path:"/"},r.a.createElement(R,null)))))))},be=a(62),he=a(138),ge=a(139),Ee=Object(be.combineReducers)({notification:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Q,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"[notification] showNotification":return Object(Z.a)(Object(Z.a)({},e),{},{msg:t.data.msg,notificationType:t.data.notificationType,open:t.data.open});case"[notification] hideNotification":return Object(Z.a)(Object(Z.a)({},e),{},{open:t.data.open});default:return e}},restaurants:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:ue,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"[restaurants] Fetch request":return Object(Z.a)(Object(Z.a)({},e),{},{isFetching:!0,isWithDistance:!1,didInvalidate:!1});case"[restaurants] Fetch success":return Object(Z.a)(Object(Z.a)({},e),{},{isFetching:!1,isWithDistance:!1,didInvalidate:!1,allRestaurants:t.payload});case"[restaurants] Fetch failure":return Object(Z.a)(Object(Z.a)({},e),{},{isFetching:!1,isWithDistance:!1,didInvalidate:!1});case se:return Object(Z.a)(Object(Z.a)({},e),{},{isFetching:!1,isWithDistance:!0,didInvalidate:!1,allRestaurants:t.payload});case"[restaurants] Invalidate data":return Object(Z.a)(Object(Z.a)({},e),{},{didInvalidate:!0});case"[restaurants] Set suggestions":return Object(Z.a)(Object(Z.a)({},e),{},{restaurantSuggestions:t.payload});default:return e}},location:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:ie,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"[location] Fetch request":return Object(Z.a)(Object(Z.a)({},e),{},{isLocating:!0,didInvalidate:!1,error:!1});case"[location] Fetch success":return Object(Z.a)(Object(Z.a)({},e),{},{isLocating:!1,didInvalidate:!1,error:!1,coordinates:t.coords});case"[location] Fetch failure":return Object(Z.a)(Object(Z.a)({},e),{},{isLocating:!1,didInvalidate:!1,error:!0});default:return e}}}),ve=Object(be.createStore)(Ee,Object(he.composeWithDevTools)(Object(be.applyMiddleware)(ge.a)));a(185),a(186),a(187),a(188);i.a.render(r.a.createElement(M.a,{store:ve},r.a.createElement(pe,null)),document.getElementById("root"))}},[[157,1,2]]]);
//# sourceMappingURL=main.d1c0d644.chunk.js.map