(this.webpackJsonpfrontend=this.webpackJsonpfrontend||[]).push([[0],{147:function(e,t,a){e.exports=a(179)},179:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),l=a(12),c=a.n(l),o=a(55),i=a.n(o),s=a(80),u=a(26),m=a(85),f=a.n(m),p=a(227),b=a(214),d=a(216),h=a(218),E=a(182),x=a(220),v=a(221),g=a(222),y=a(219),j=Object(b.a)({root:{maxWidth:296,minWidth:250,margin:"8px 8px"},bullet:{display:"inline-block",margin:"0 4px"},skeleton:{marginLeft:"8px",marginBottom:"8px"}}),O=function(e){var t=e.restaurant,a=j();return r.a.createElement(d.a,{className:a.root},r.a.createElement(h.a,null,r.a.createElement(E.a,{gutterBottom:!0,variant:"h5",component:"h2"},t?t.name:r.a.createElement(y.a,null))),r.a.createElement(x.a,null,t?r.a.createElement(v.a,{size:"small",color:"primary"},t.website&&r.a.createElement(g.a,{href:t.website},"Website")):r.a.createElement(y.a,{variant:"rect",width:56,height:22,className:a.skeleton})))},w=a(229),M=a(234),S=a(235),F=a(233),N=a(223),k=a(224),W=a(225),R=Object(b.a)({map:{width:"100%",minWidth:"250px",paddingBottom:"min(75%, 80vh)"}}),D=function(e){var t=e.userLocation,a=e.restaurantSuggestions,l=Object(n.useState)([[62.9894714,34.558059],[38.1706012,-3.976497]]),c=Object(u.a)(l,2),o=c[0],i=c[1],s=Object(n.useRef)(),m=R();return Object(n.useEffect)((function(){s.current.leafletElement.invalidateSize()})),Object(n.useEffect)((function(){t&&function(){if(a){var e=a.reduce((function(e,t){return Math.max(e,t.latlon.x)}),t.lat),n=a.reduce((function(e,t){return Math.min(e,t.latlon.y)}),t.lon),r=a.reduce((function(e,t){return Math.min(e,t.latlon.x)}),t.lat),l=a.reduce((function(e,t){return Math.max(e,t.latlon.y)}),t.lon);i([[e,l],[r,n]])}else i([[t.lat,t.lon],[t.lat,t.lon]])}()}),[a,i,t]),r.a.createElement(r.a.Fragment,null,r.a.createElement(w.a,{id:"map",flex:"1",margin:"8px"},r.a.createElement(M.a,{ref:s,useFlyTo:"true",bounds:o,boundsOptions:{padding:[35,35]},scrollWheelZoom:!1,className:m.map},r.a.createElement(S.a,{url:"https://api.mapbox.com/styles/v1/mapbox/streets-v11/tiles/256/{z}/{x}/{y}?access_token=".concat("pk.eyJ1IjoidG9tbWlzIiwiYSI6ImNrY2FjMXZoazFkZmoyc3A4MzR6NHhta3UifQ.FEItf-Tx4knfi3RtN88_FA"),attribution:'\xa9 <a href="https://www.openstreetmap.org/">OpenStreetMap</a>, <a href="https://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, \xa9 <a href="https://www.mapbox.com/">Mapbox</a>'}),t&&r.a.createElement(F.a,{center:t,radius:15},r.a.createElement(N.a,null,r.a.createElement(E.a,{variant:"subtitle1"},"Your location"))),a&&a.map((function(e){return r.a.createElement(k.a,{key:e.id,position:[e.latlon.x,e.latlon.y]},r.a.createElement(W.a,{permanent:!0},e.name),r.a.createElement(N.a,null,r.a.createElement(E.a,{variant:"h6"},e.name),r.a.createElement(g.a,{href:e.website},e.website)))})))))},C=function(e){var t=e.restaurants,a=e.userLocation,l=e.isWithDistance,c=e.setNotification,o=Object(n.useState)(),i=Object(u.a)(o,2),s=i[0],m=i[1],f=Object(n.useState)(!0),p=Object(u.a)(f,2),b=p[0],d=p[1];return Object(n.useEffect)((function(){var e=!1;if(t&&a&&l){var n=function a(n){var r=t.filter((function(e){return e.distance<n/1e3}));return!e&&r.length<2?(e=!0,a(2e3)):0===r.length?null:r}(700);n?function(e,t){var a=function(e){var t,a,n=e.length;for(;0!==n;)a=Math.floor(Math.random()*n),t=e[n-=1],e[n]=e[a],e[a]=t;return e}(e);m(a.splice(0,t))}(n,3):(c({message:"No restaurants found near your location. Try refreshing the page at a different location.",type:"error"}),d(!1))}}),[t,a,l,c]),r.a.createElement(r.a.Fragment,null,r.a.createElement(w.a,{id:"restaurant-suggestions",display:"flex",flex:"1 0 auto",justifyContent:"center",flexDirection:"row",flexWrap:"wrap"},b&&r.a.createElement(w.a,{display:"flex",flexDirection:"column"},(s||Array.from(new Array(3))).map((function(e,t){return r.a.createElement(w.a,{key:t},r.a.createElement(O,{restaurant:e}))}))),r.a.createElement(D,{userLocation:a,restaurantSuggestions:s})))},L=function(){return r.a.createElement("div",null,r.a.createElement(E.a,{id:"page-header",variant:"h4",align:"center",gutterBottom:!0},"Lunch Near Me"))},z=a(228),A=a(27),q=Object(b.a)({root:{margin:"8px 16px"}}),I=function(e){var t=e.searchResult,a=e.fillFormWithData,n=q(),l=t.address.amenity,c=t.extratags.website,o="".concat(t.lat,",").concat(t.lon);return r.a.createElement(d.a,{className:n.root},r.a.createElement(h.a,null,r.a.createElement(E.a,{variant:"h5"},l),r.a.createElement(g.a,{href:c},c),r.a.createElement("br",null),r.a.createElement(v.a,{color:"primary",onClick:function(){return a(l,"",c,o)}},"Fill the data")))},B=function(e){var t=e.searchResults,a=e.fillFormWithData;return r.a.createElement(w.a,{id:"search-results",display:"flex",flexDirection:"row",justifyContent:"center"},t.map((function(e){return r.a.createElement(I,{key:e.place_id,searchResult:e,fillFormWithData:a})})))},J=function(e){return e*(Math.PI/180)},T=function(e){return{x1:e.lon-.45,y1:e.lat-.45,x2:e.lon+.45,y2:e.lat+.45}},Y=a(76),V=a(84),Z=Object(b.a)({textField:{minWidth:"250px"}}),_=function(e){var t=e.userLocation,a=Object(n.useState)([]),l=Object(u.a)(a,2),c=l[0],o=l[1],m=Object(n.useState)({name:"",subtitle:"",website:"",latlon:""}),p=Object(u.a)(m,2),b=p[0],d=p[1],h=Z(),x=function(){var e=Object(s.a)(i.a.mark((function e(a){var n,r,l,c,s,u,m;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=T(t),r=n.x1,l=n.y1,c=n.x2,s=n.y2,e.next=3,fetch("https://nominatim.openstreetmap.org/?addressdetails=1&q=".concat(a,"&format=json&limit=5&viewbox=").concat(r,",").concat(l,",").concat(c,",").concat(s,"&extratags=1&bounded=1"));case 3:return u=e.sent,e.next=6,u.json();case 6:(m=e.sent).length?(console.log(m),o(m)):alert("No search results found");case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return r.a.createElement(w.a,null,r.a.createElement(E.a,{variant:"h4"},"Add a new restaurant"),r.a.createElement(A.c,{initialValues:{search:""},onSubmit:function(e,t){var a=t.resetForm;x(JSON.stringify(e.search)),a({values:""})}},r.a.createElement(A.b,null,r.a.createElement("label",{htmlFor:"search"},"Search for a restaurant from Open Street Map data"),r.a.createElement("br",null),r.a.createElement(A.a,{component:Y.a,className:h.textField,label:"Restaurant name",name:"search",type:"text"}),r.a.createElement("br",null),r.a.createElement(v.a,{color:"primary",type:"submit"},"Search"))),r.a.createElement(B,{searchResults:c,fillFormWithData:function(e,t,a,n){d({name:e,subtitle:t,website:a,latlon:n})}}),r.a.createElement(E.a,{variant:"h6"},"Add manually"),r.a.createElement(A.c,{enableReinitialize:!0,initialValues:b,validationSchema:V.a({name:V.b().max(40,"Must be 40 characters or less").required("Required"),website:V.b().url("Must be a valid url"),latlon:V.b().required("Required")}),onSubmit:function(){var e=Object(s.a)(i.a.mark((function e(t,a){var n,r;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=a.resetForm,r={name:t.name,subtitle:t.subtitle,website:t.website,latlon:"(".concat(t.latlon,")")},e.next=4,f.a.post("/restaurants",r);case 4:n({values:""});case 5:case"end":return e.stop()}}),e)})));return function(t,a){return e.apply(this,arguments)}}()},(function(e){return r.a.createElement(A.b,null,r.a.createElement(A.a,{component:Y.a,className:h.textField,label:"Name",name:"name",type:"text"}),r.a.createElement("br",null),r.a.createElement(A.a,{component:Y.a,className:h.textField,label:"Specifier",name:"subtitle",type:"text"}),r.a.createElement("br",null),r.a.createElement(A.a,{component:Y.a,className:h.textField,label:"Website",name:"website",type:"text"}),r.a.createElement("br",null),r.a.createElement(A.a,{component:Y.a,className:h.textField,label:"Coordinates lat, lon",name:"latlon",type:"text"}),r.a.createElement("br",null),r.a.createElement(v.a,{type:"submit",variant:"contained",color:"primary",disableElevation:!0,disabled:!(e.isValid&&e.dirty)},"Add restaurant"))})))},G=a(130),H=a(16),P=a(232),Q=a(230);function U(e){return r.a.createElement(Q.a,Object.assign({elevation:6,variant:"filled"},e))}var X=Object(b.a)((function(e){return{root:{width:"100%","& > * + *":{marginTop:e.spacing(2)}}}})),K=function(e){var t=e.notification,a=X(),l=Object(n.useState)(!0),c=Object(u.a)(l,2),o=c[0],i=c[1],s=function(e,t){"clickaway"!==t&&i(!1)};return null===t?null:r.a.createElement("div",{className:a.root},r.a.createElement(P.a,{open:o,autoHideDuration:6e3,onClose:s,anchorOrigin:{vertical:"top",horizontal:"center"}},r.a.createElement(U,{onClose:s,severity:"warning"},t.message)))},$=Object(b.a)({root:{padding:"24px"}}),ee=function(){var e=Object(n.useState)(null),t=Object(u.a)(e,2),a=t[0],l=t[1],c=Object(n.useState)(null),o=Object(u.a)(c,2),m=o[0],b=o[1],d=Object(n.useState)(!1),h=Object(u.a)(d,2),E=h[0],x=h[1],v=Object(n.useState)(null),g=Object(u.a)(v,2),y=g[0],j=g[1],O=$();return Object(n.useEffect)((function(){(function(){var e=Object(s.a)(i.a.mark((function e(){var t;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,f.a.get("/restaurants");case 2:t=e.sent,l(t.data);case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}})()()}),[]),Object(n.useEffect)((function(){navigator.geolocation?navigator.geolocation.getCurrentPosition((function(e){var t={lat:e.coords.latitude,lon:e.coords.longitude};j(null),b(t),x(!1)}),(function(){j({message:"Location is needed to show the restaurant suggestions.",type:"error"})})):j({message:"Geolocation is not supported by your browser",type:"error"})}),[]),Object(n.useEffect)((function(){m&&a&&!E&&function(){var e=a.map((function(e){return e.distance=function(e,t,a,n){var r=J(a-e),l=J(n-t),c=Math.sin(r/2)*Math.sin(r/2)+Math.cos(J(e))*Math.cos(J(a))*Math.sin(l/2)*Math.sin(l/2);return(6371*(2*Math.atan2(Math.sqrt(c),Math.sqrt(1-c)))).toFixed(2)}(m.lat,m.lon,e.latlon.x,e.latlon.y),e}));l(e),x(!0)}()}),[m,a,E]),r.a.createElement(r.a.Fragment,null,r.a.createElement(p.a,null),r.a.createElement(z.a,{maxWidth:"lg",className:O.root},r.a.createElement(w.a,{display:"flex",flexDirection:"column"},r.a.createElement(G.a,null,r.a.createElement(L,null),r.a.createElement(H.c,null,r.a.createElement(H.a,{path:"/addRestaurant"},r.a.createElement(_,{userLocation:m})),r.a.createElement(H.a,{path:"/"},r.a.createElement(K,{notification:y}),r.a.createElement(C,{restaurants:a,setRestaurants:l,userLocation:m,isWithDistance:E,setNotification:j})))))))};a(175),a(176),a(177),a(178);c.a.render(r.a.createElement(ee,null),document.getElementById("root"))}},[[147,1,2]]]);
//# sourceMappingURL=main.c1fd7d2f.chunk.js.map