(this.webpackJsonpfrontend=this.webpackJsonpfrontend||[]).push([[0],{109:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),l=a(26),o=a.n(l),c=a(29),i=a.n(c),s=a(35),u=a(23),m=a(37),d=a.n(m),p=a(133),h=a(125),f=a(139),b=a(126),E=a(111),g=a(127),x=a(136),y=a(128),v=Object(h.a)({root:{maxWidth:300,margin:"8px 16px"},media:{height:140},bullet:{display:"inline-block",margin:"0 4px"}}),w=function(e){var t=e.restaurant,a=v(),n=r.a.createElement("span",{className:a.bullet},"\u2022");return r.a.createElement(f.a,{className:a.root},r.a.createElement(b.a,null,r.a.createElement(E.a,{gutterBottom:!0,variant:"h5",component:"h2"},t.name),r.a.createElement(E.a,{variant:"body2",color:"textSecondary",component:"p"},"Takeaway",n,"Big groups",n,"Fast service",n,"Buffet")),r.a.createElement(g.a,null,r.a.createElement(x.a,{size:"small",color:"primary"},r.a.createElement(y.a,{href:t.website},"Website"))))},j=function(e){return e*(Math.PI/180)},O=function(e,t){navigator.geolocation?(navigator.geolocation.getCurrentPosition((function(a){var n={lat:a.coords.latitude,lon:a.coords.longitude};t({message:null,type:null}),console.log("User location: ",n),e(n)}),(function(){t({message:"Location is needed to show the restaurant suggestions.",type:"error"})})),t({message:"Locating...",type:"spinner"})):t({message:"Geolocation is not supported by your browser",type:"error"})},S=function(e){return{x1:e.lon-.45,y1:e.lat-.45,x2:e.lon+.45,y2:e.lat+.45}},F=a(135),M=a(140),C=a(141),k=a(138),D=a(129),W=a(130),N=a(131),R=function(e){var t=e.userLocation,a=e.restaurantSuggestions;return r.a.createElement(r.a.Fragment,null,r.a.createElement(F.a,{id:"map",flex:"1",padding:"8px"},r.a.createElement(M.a,{bounds:function(e,t){var a=e.reduce((function(e,t){return Math.max(e,t.latlon.x)}),t.lat),n=e.reduce((function(e,t){return Math.min(e,t.latlon.y)}),t.lon),r=e.reduce((function(e,t){return Math.min(e,t.latlon.x)}),t.lat);return[[a,e.reduce((function(e,t){return Math.max(e,t.latlon.y)}),t.lon)],[r,n]]}(a,t),boundsOptions:{padding:[35,35]},scrollWheelZoom:!1,style:{width:"100%",height:"100%"}},r.a.createElement(C.a,{url:"https://api.mapbox.com/styles/v1/mapbox/streets-v11/tiles/256/{z}/{x}/{y}?access_token=".concat("pk.eyJ1IjoidG9tbWlzIiwiYSI6ImNrY2FjMXZoazFkZmoyc3A4MzR6NHhta3UifQ.FEItf-Tx4knfi3RtN88_FA"),attribution:'\xa9 <a href="https://www.openstreetmap.org/">OpenStreetMap</a>, <a href="https://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, \xa9 <a href="https://www.mapbox.com/">Mapbox</a>'}),t&&r.a.createElement(k.a,{center:t,radius:15},r.a.createElement(D.a,null,r.a.createElement(E.a,{variant:"subtitle1"},"Your location"))),a&&a.map((function(e){return r.a.createElement(W.a,{key:e.id,position:[e.latlon.x,e.latlon.y]},r.a.createElement(N.a,{permanent:!0},e.name),r.a.createElement(D.a,null,r.a.createElement(E.a,{variant:"h6"},e.name),r.a.createElement(y.a,{href:e.website},e.website)))})))))},L=function(e){var t=e.restaurants,a=e.setRestaurants,l=e.userLocation,o=Object(n.useState)(!1),c=Object(u.a)(o,2),i=c[0],s=c[1],m=Object(n.useState)(null),d=Object(u.a)(m,2),p=d[0],h=d[1];return Object(n.useEffect)((function(){var e;l&&!i&&(!function(){var e=t.map((function(e){return e.distance=function(e,t,a,n){var r=j(a-e),l=j(n-t),o=Math.sin(r/2)*Math.sin(r/2)+Math.cos(j(e))*Math.cos(j(a))*Math.sin(l/2)*Math.sin(l/2);return(6371*(2*Math.atan2(Math.sqrt(o),Math.sqrt(1-o)))).toFixed(2)}(l.lat,l.lon,e.latlon.x,e.latlon.y),e}));a(e),s(!0)}(),function(e,t){var a=function(e){var t,a,n=e.length;for(;0!==n;)a=Math.floor(Math.random()*n),t=e[n-=1],e[n]=e[a],e[a]=t;return e}(e);h(a.splice(0,t))}((e=700,t.filter((function(t){return t.distance<e/1e3}))),3))}),[t,a,l,i]),r.a.createElement(r.a.Fragment,null,p&&r.a.createElement(F.a,{id:"restaurant-suggestions",display:"flex",flex:"1 0 auto",flexDirection:"row",flexWrap:"wrap"},r.a.createElement(F.a,{display:"flex",flexDirection:"column"},p.map((function(e){return r.a.createElement(F.a,{key:e.id},r.a.createElement(w,{restaurant:e}))}))),r.a.createElement(R,{userLocation:l,restaurantSuggestions:p})))},B=function(){return r.a.createElement("div",null,r.a.createElement(E.a,{id:"page-header",variant:"h4",align:"center",gutterBottom:!0},"Lunch Near Me"))},I=a(134),A=a(52),V=Object(h.a)({root:{margin:"8px 16px"}}),z=function(e){var t=e.searchResult,a=e.fillFormWithData,n=V(),l=t.address.amenity,o=t.extratags.website,c="".concat(t.lat,",").concat(t.lon);return r.a.createElement(f.a,{className:n.root},r.a.createElement(b.a,null,r.a.createElement(E.a,{variant:"h5"},l),r.a.createElement(y.a,{href:o},o),r.a.createElement("br",null),r.a.createElement(x.a,{color:"primary",onClick:function(){return a(l,"",o,c)}},"Fill the data")))},J=function(e){var t=e.searchResults,a=e.fillFormWithData;return r.a.createElement(F.a,{id:"search-results",display:"flex",flexDirection:"row",justifyContent:"center"},t.map((function(e){return r.a.createElement(z,{key:e.place_id,searchResult:e,fillFormWithData:a})})))},Y=function(e){var t=e.userLocation,a=Object(n.useState)([]),l=Object(u.a)(a,2),o=l[0],c=l[1],m=function(){var e=Object(s.a)(i.a.mark((function e(a){var n,r,l,o,s,u,m;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=S(t),r=n.x1,l=n.y1,o=n.x2,s=n.y2,console.log("Bounding box: ",r,l,o,s),e.next=4,fetch("https://nominatim.openstreetmap.org/?addressdetails=1&q=".concat(a,"&format=json&limit=5&viewbox=").concat(r,",").concat(l,",").concat(o,",").concat(s,"&extratags=1&bounded=1"));case 4:return u=e.sent,e.next=7,u.json();case 7:(m=e.sent).length?(console.log(m),c(m)):alert("No search results found");case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),p=Object(A.a)({initialValues:{search:""},onSubmit:function(e){m(JSON.stringify(e.search))}}),h=Object(A.a)({initialValues:{name:"",subtitle:"",website:"",latlon:""},onSubmit:function(){var e=Object(s.a)(i.a.mark((function e(t){var a,n;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a={name:t.name,subtitle:t.subtitle,website:t.website,latlon:"(".concat(t.latlon,")")},e.next=3,d.a.post("/restaurants",a);case 3:n=e.sent,console.log("res.data: ",n.data);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()});return r.a.createElement(F.a,null,r.a.createElement(E.a,{variant:"h5"},"Add a new restaurant"),r.a.createElement("form",{onSubmit:p.handleSubmit},r.a.createElement("label",{htmlFor:"search"},"Search for a restaurant to add"),r.a.createElement("input",{id:"search",name:"search",type:"text",onChange:p.handleChange,value:p.values.search}),r.a.createElement("button",{type:"submit"},"Search")),r.a.createElement(J,{searchResults:o,fillFormWithData:function(e,t,a,n){h.setFieldValue("name",e),h.setFieldValue("subtitle",t),h.setFieldValue("website",a),h.setFieldValue("latlon",n)}}),r.a.createElement(E.a,{variant:"h6"},"Add manually"),r.a.createElement("form",{onSubmit:h.handleSubmit},r.a.createElement("label",{htmlFor:"name"},"Name"),r.a.createElement("input",{id:"name",name:"name",type:"text",onChange:h.handleChange,value:h.values.name}),r.a.createElement("br",null),r.a.createElement("label",{htmlFor:"subtitle"},"Specifier"),r.a.createElement("input",{id:"subtitle",name:"subtitle",type:"text",onChange:h.handleChange,value:h.values.subtitle}),r.a.createElement("br",null),r.a.createElement("label",{htmlFor:"website"},"Website"),r.a.createElement("input",{id:"website",name:"website",type:"text",onChange:h.handleChange,value:h.values.website}),r.a.createElement("br",null),r.a.createElement("label",{htmlFor:"latlon"},"Coordinates lat, lon"),r.a.createElement("input",{id:"latlon",name:"latlon",type:"text",onChange:h.handleChange,value:h.values.latlon}),r.a.createElement("br",null),r.a.createElement("button",{type:"submit"},"Add to database")))},q=a(47),Z=a(9),_=a(132),G=function(e){var t=e.notification;return null===t?null:"spinner"===t.type?r.a.createElement("div",null,t.message,r.a.createElement(_.a,null)):r.a.createElement("div",null,t.message)},P=function(){var e=Object(n.useState)(null),t=Object(u.a)(e,2),a=t[0],l=t[1],o=Object(n.useState)(null),c=Object(u.a)(o,2),m=c[0],h=c[1],f=Object(n.useState)(null),b=Object(u.a)(f,2),E=b[0],g=b[1];return Object(n.useEffect)((function(){(function(){var e=Object(s.a)(i.a.mark((function e(){var t;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,d.a.get("/restaurants");case 2:t=e.sent,l(t.data);case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}})()()}),[]),r.a.createElement(r.a.Fragment,null,r.a.createElement(p.a,null),r.a.createElement(I.a,{maxWidth:"md",style:{padding:"24px"}},r.a.createElement(F.a,{display:"flex",flexDirection:"column"},r.a.createElement(q.a,null,r.a.createElement(B,null),r.a.createElement(F.a,{display:"flex",flexDirection:"column",alignItems:"center",style:{padding:"10px",margin:"10px"}},r.a.createElement(q.b,{to:"/",style:{textDecoration:"none"}},r.a.createElement(x.a,{id:"locate-button",variant:"contained",color:"primary",disableElevation:!0,type:"button",onClick:function(){return O(h,g)},style:{marginBottom:"10px"}},"Show me my options")),r.a.createElement(q.b,{to:"/addRestaurant",style:{textDecoration:"none"}},r.a.createElement(x.a,{id:"add-restaurant-button",color:"secondary",onClick:function(){return O(h,g)}},"Add a new restaurant"))),r.a.createElement(Z.c,null,r.a.createElement(Z.a,{path:"/addRestaurant"},r.a.createElement(Y,{userLocation:m})),r.a.createElement(Z.a,{path:"/"},r.a.createElement(G,{notification:E}),m&&r.a.createElement(L,{restaurants:a,setRestaurants:l,userLocation:m})))))))};a(105),a(106),a(107),a(108);o.a.render(r.a.createElement(r.a.StrictMode,null,r.a.createElement(P,null)),document.getElementById("root"))},77:function(e,t,a){e.exports=a(109)}},[[77,1,2]]]);
//# sourceMappingURL=main.d8058fdb.chunk.js.map